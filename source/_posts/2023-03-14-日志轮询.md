---
title: 日志轮询
categories:
  - 演示
mathjax: true
top_img: https://cdn1.tianli0.top/gh/linjiangyu2/halo/img/yyyyyy.jpg
cover: https://cdn1.tianli0.top/gh/linjiangyu2/halo/img/yyyyyy.jpg
description: 日志轮询
abbrlink: 3f7ad5be
date: 2023-03-14 19:27:14
tags:
  - null
---
### 日志轮询
#### 意义
- 1.日志轮询可以确保系统日志文件不会无限增长，以免影响系统性能并占用过多的磁盘空间。通过定期轮询日志文件，旧的日志信息可以得到保留，从而为故障排除和性能分析提供重要的历史数据
- 2.日志轮询可以将日志文件分割为多个较小的文件，每个文件包含一段时间内的日志信息。这将使日志检索更加高效，因为只需要搜索特定时间段内的日志文件，而不需要搜索整个日志文件。这也有助于加快故障排除和性能分析的速度
- 3.日志轮询可以使日志管理和维护更加方便。由于每个日志文件都包含一段时间范围内的日志信息，因此可以轻松地对特定时间段内的日志进行备份、压缩、归档或删除。此外，日志轮询还可以帮助识别和修复日志文件中的错误或损坏
#### 实操
- example
  - 日志文件/var/log/messages一月一轮询
  - 日志文件大于10M时，直接主动进行轮询不需要考虑一月一轮询
  - 保存5个备份文件
  - 备份文件需要压缩
    ```nginx
    # chattr +a /var/log/messages
    # vim /etc/logrotate.d/messages        # 定义轮询规则
    /var/log/messages {
            monthly			# 每个月进行一次
            size=8M			# 文件容量大于10M时开始轮询
            rotate  5		# 保留五个文件
            compress		# 进行压缩
            sharedscripts
            prerotate
                    /usr/bin/chattr -a /var/log/messages
            endscript
            sharedscripts
            postrotate
                    /bin/kill -HUP `cat /var/run/syslogd.pid 2>/dev/null` 2>/dev/null || true
                    /usr/bin/chattr +a /var/log/messages
            endscript
    }
    
    # logrotate -vf /etc/logrotate.conf   // 查看轮询
    // 可以通过别的文件重定向到/var/log/messages中让文件达到10M大小测试轮询
    ```
